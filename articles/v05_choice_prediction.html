<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Choice prediction • RprobitB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Choice prediction">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RprobitB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/RprobitB.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01_model_definition.html">Model definition</a></li>
    <li><a class="dropdown-item" href="../articles/v02_choice_data.html">Choice data</a></li>
    <li><a class="dropdown-item" href="../articles/v03_model_fitting.html">Model fitting</a></li>
    <li><a class="dropdown-item" href="../articles/v04_modeling_heterogeneity.html">Modeling heterogeneity</a></li>
    <li><a class="dropdown-item" href="../articles/v05_choice_prediction.html">Choice prediction</a></li>
    <li><a class="dropdown-item" href="../articles/v06_model_selection.html">Model selection</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/loelschlaeger/RprobitB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Choice prediction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/loelschlaeger/RprobitB/blob/main/vignettes/v05_choice_prediction.Rmd" class="external-link"><code>vignettes/v05_choice_prediction.Rmd</code></a></small>
      <div class="d-none name"><code>v05_choice_prediction.Rmd</code></div>
    </div>

    
    
<p>This vignette<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;This vignette is built using R 4.4.1 with the
&lt;a href="https://loelschlaeger.de/RprobitB/"&gt;RprobitB&lt;/a&gt; 1.1.4 package.&lt;/p&gt;'><sup>1</sup></a> discusses in-sample and out-of-sample
prediction within <a href="https://loelschlaeger.de/RprobitB/">RprobitB</a>. The former case refers to
reproducing the observed choices on the basis of the covariates and the
fitted model and subsequently using the deviations between prediction
and reality as an indicator for the model performance. The latter means
forecasting choice behavior for changes in the choice attributes.</p>
<p>For illustration, we revisit the probit model of travelers deciding
between two fictional train route alternatives from <a href="https://loelschlaeger.de/RprobitB/articles/v03_model_fitting.html">the
vignette on model fitting</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="va">choice</span> <span class="op">~</span> <span class="va">price</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">change</span> <span class="op">+</span> <span class="va">comfort</span> <span class="op">|</span> <span class="fl">0</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>form <span class="op">=</span> <span class="va">form</span>, choice_data <span class="op">=</span> <span class="va">train_choice</span>, id <span class="op">=</span> <span class="st">"deciderID"</span>, idc <span class="op">=</span> <span class="st">"occasionID"</span><span class="op">)</span></span>
<span><span class="va">model_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"price := -1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="reproducing-the-observed-choices">Reproducing the observed choices<a class="anchor" aria-label="anchor" href="#reproducing-the-observed-choices"></a>
</h2>
<p><a href="https://loelschlaeger.de/RprobitB/">RprobitB</a> provides a <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method for
<code>RprobitB_fit</code> objects. Per default, the method returns a
confusion matrix, which gives an overview of the in-sample prediction
performance:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_train</span><span class="op">)</span></span>
<span><span class="co">#&gt;     predicted</span></span>
<span><span class="co">#&gt; true    A    B</span></span>
<span><span class="co">#&gt;    A 1030  444</span></span>
<span><span class="co">#&gt;    B  448 1007</span></span></code></pre></div>
<p>By setting the argument <code>overview = FALSE</code>, the method
instead returns predictions on the level of individual choice
occasions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_train</span>, overview <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    deciderID occasionID    A    B true predicted correct</span></span>
<span><span class="co">#&gt; 1          1          1 0.92 0.08    A         A    TRUE</span></span>
<span><span class="co">#&gt; 2          1          2 0.64 0.36    A         A    TRUE</span></span>
<span><span class="co">#&gt; 3          1          3 0.79 0.21    A         A    TRUE</span></span>
<span><span class="co">#&gt; 4          1          4 0.18 0.82    B         B    TRUE</span></span>
<span><span class="co">#&gt; 5          1          5 0.55 0.45    B         A   FALSE</span></span>
<span><span class="co">#&gt; 6          1          6 0.13 0.87    B         B    TRUE</span></span>
<span><span class="co">#&gt; 7          1          7 0.54 0.46    B         A   FALSE</span></span>
<span><span class="co">#&gt; 8          1          8 0.76 0.24    B         A   FALSE</span></span>
<span><span class="co">#&gt; 9          1          9 0.55 0.45    A         A    TRUE</span></span>
<span><span class="co">#&gt; 10         1         10 0.59 0.41    A         A    TRUE</span></span></code></pre></div>
<p>Among the three incorrect predictions shown here, the one for decider
<code>id = 1</code> in choice occasion <code>idc = 8</code> is the most
outstanding. Alternative <code>B</code> was chosen although the model
predicts a probability of 75% for alternative <code>A</code>. We can use
the convenience function <code><a href="../reference/get_cov.html">get_cov()</a></code> to extract the
characteristics of this particular choice situation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_cov.html">get_cov</a></span><span class="op">(</span><span class="va">model_train</span>, id <span class="op">=</span> <span class="fl">1</span>, idc <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;   deciderID occasionID choice  price_A   time_A change_A comfort_A  price_B</span></span>
<span><span class="co">#&gt; 8         1          8      B 52.88904 1.916667        0         1 70.51872</span></span>
<span><span class="co">#&gt;   time_B change_B comfort_B</span></span>
<span><span class="co">#&gt; 8    2.5        0         0</span></span></code></pre></div>
<p>The trip option <code>A</code> was 20€ cheaper and 30 minutes faster,
which by our model outweighs the better comfort class for alternative
<code>B</code>, recall the estimated effects:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_train</span><span class="op">)</span></span>
<span><span class="co">#&gt;            Estimate   (sd)</span></span>
<span><span class="co">#&gt; 1   price     -1.00 (0.00)</span></span>
<span><span class="co">#&gt; 2    time    -25.39 (2.07)</span></span>
<span><span class="co">#&gt; 3  change     -4.89 (0.88)</span></span>
<span><span class="co">#&gt; 4 comfort    -14.35 (0.95)</span></span></code></pre></div>
<p>The misclassification can be explained by preferences that differ
from the average decider (choice behavior heterogeneity), or by
unobserved factors that influenced the choice. Indeed, the variance of
the error term was estimated high:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/point_estimates.html">point_estimates</a></span><span class="op">(</span><span class="va">model_train</span><span class="op">)</span><span class="op">$</span><span class="va">Sigma</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 648.0326</span></span>
<span><span class="co">#&gt; attr(,"names")</span></span>
<span><span class="co">#&gt; [1] "1,1"</span></span></code></pre></div>
<p>Apart from the prediction accuracy, the model performance can be
evaluated more nuanced in terms of sensitivity and specificity. The
following snippet exemplary shows how to visualize these measures by
means of a receiver operating characteristic (ROC) curve <span class="citation">(<a href="#ref-Fawcett2006">Fawcett 2006</a>)</span>,
using the <a href="https://sachsmc.github.io/plotROC/" class="external-link">plotROC</a> package <span class="citation">(<a href="#ref-Sachs2017">Sachs 2017</a>)</span>. The curve is constructed
by plotting the true positive fraction against the false positive
fraction at various cutoffs (here <code>n.cuts = 20</code>). The closer
the curve is to the top-left corner, the better the binary
classification.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/plotROC/" class="external-link">plotROC</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">A</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">true</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/geom_roc.html" class="external-link">geom_roc</a></span><span class="op">(</span>n.cuts <span class="op">=</span> <span class="fl">20</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/style_roc.html" class="external-link">style_roc</a></span><span class="op">(</span>theme <span class="op">=</span> <span class="va">theme_grey</span><span class="op">)</span></span></code></pre></div>
<p><img src="img%2Froc-example-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="forecasting-choice-behavior">Forecasting choice behavior<a class="anchor" aria-label="anchor" href="#forecasting-choice-behavior"></a>
</h2>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method has an additional <code>data</code>
argument. Per default, <code>data = NULL</code>, which results into the
in-sample case outlined above. Alternatively, <code>data</code> can be
either</p>
<ul>
<li><p>an <code>RprobitB_data</code> object (for example the test
subsample derived from the <code><a href="../reference/train_test.html">train_test()</a></code> function, see <a href="https://loelschlaeger.de/RprobitB/articles/v02_choice_data.html">the
vignette on choice data</a>),</p></li>
<li><p>or a data frame of custom choice characteristics.</p></li>
</ul>
<p>We demonstrate the second case in the following. Assume that a train
company wants to anticipate the effect of a price increase on their
market share. By our model, increasing the ticket price from 100€ to
110€ (ceteris paribus) draws 15% of the customers to the competitor who
does not increase their prices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">model_train</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">"price_A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">110</span><span class="op">)</span>,</span>
<span>    <span class="st">"price_B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  overview <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   deciderID occasionID    A    B prediction</span></span>
<span><span class="co">#&gt; 1         1          1 0.50 0.50          A</span></span>
<span><span class="co">#&gt; 2         2          1 0.35 0.65          B</span></span></code></pre></div>
<p>However, offering a better comfort class compensates for the higher
price and even results in a gain of 7% market share:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">model_train</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">"price_A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">110</span><span class="op">)</span>,</span>
<span>    <span class="st">"comfort_A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="st">"price_B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>    <span class="st">"comfort_B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  overview <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   deciderID occasionID    A    B prediction</span></span>
<span><span class="co">#&gt; 1         1          1 0.50 0.50          A</span></span>
<span><span class="co">#&gt; 2         2          1 0.57 0.43          A</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Fawcett2006" class="csl-entry">
Fawcett, T. 2006. <span>“An Introduction to <span>ROC</span>
Analysis.”</span> <em>Pattern Recognition Letters</em> 27 (8). <a href="https://doi.org/10.1016/j.patrec.2005.10.010" class="external-link">https://doi.org/10.1016/j.patrec.2005.10.010</a>.
</div>
<div id="ref-Sachs2017" class="csl-entry">
Sachs, M. C. 2017. <span>“<span class="nocase">plotROC</span>: A Tool
for Plotting <span>ROC</span> Curves.”</span> <em>Journal of Statistical
Software, Code Snippets</em> 79 (2): 1–19. <a href="https://doi.org/10.18637/jss.v079.c02" class="external-link">https://doi.org/10.18637/jss.v079.c02</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a>, <a href="https://de.wikipedia.org/wiki/Dietmar_Bauer" class="external-link">Dietmar Bauer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
