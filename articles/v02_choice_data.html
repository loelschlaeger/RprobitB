<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RprobitB">
<title>Choice data • RprobitB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Choice data">
<meta property="og:description" content="RprobitB">
<meta property="og:image" content="https://loelschlaeger.de/RprobitB/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RprobitB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/RprobitB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v01_model_definition.html">Model definition</a>
    <a class="dropdown-item" href="../articles/v02_choice_data.html">Choice data</a>
    <a class="dropdown-item" href="../articles/v03_model_fitting.html">Model fitting</a>
    <a class="dropdown-item" href="../articles/v04_modeling_heterogeneity.html">Modeling heterogeneity</a>
    <a class="dropdown-item" href="../articles/v05_choice_prediction.html">Choice prediction</a>
    <a class="dropdown-item" href="../articles/v06_model_selection.html">Model selection</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/loelschlaeger/RprobitB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Choice data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/loelschlaeger/RprobitB/blob/HEAD/vignettes/v02_choice_data.Rmd" class="external-link"><code>vignettes/v02_choice_data.Rmd</code></a></small>
      <div class="d-none name"><code>v02_choice_data.Rmd</code></div>
    </div>

    
    
<p>No choice model without choice data, so this vignette<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;This vignette is build using R 4.3.2 with the
&lt;a href="https://loelschlaeger.de/RprobitB/"&gt;RprobitB&lt;/a&gt; 1.1.4 package.&lt;/p&gt;'><sup>1</sup></a> provides a reference
for data management in <a href="https://loelschlaeger.de/RprobitB/">RprobitB</a>. We use the
<code>train_choice</code> data set for illustration.</p>
<div class="section level2">
<h2 id="requirements-to-choice-data">Requirements to choice data<a class="anchor" aria-label="anchor" href="#requirements-to-choice-data"></a>
</h2>
<p><a href="https://loelschlaeger.de/RprobitB/">RprobitB</a> helps in modeling the choice of individual
deciders of one alternative from a finite set of choice alternatives.
This choice set has to fulfill three properties <span class="citation">(<a href="#ref-Train2009" role="doc-biblioref">Train
2009</a>)</span>: Choices need to be</p>
<ol style="list-style-type: decimal">
<li><p>mutually exclusive (one can choose one and only one alternative
that are all different),</p></li>
<li><p>exhaustive (the alternatives do not leave other options
open),</p></li>
<li><p>and finitely many.</p></li>
</ol>
<p>Every decider may take one or repeated choices (called choice
occasions). The data set thus contains information on</p>
<ol style="list-style-type: decimal">
<li><p>an identifier for each decider (and optionally for each choice
situation),</p></li>
<li><p>the choices,</p></li>
<li><p>alternative and decider specific covariates.</p></li>
</ol>
<p>Additionally, <a href="https://loelschlaeger.de/RprobitB/">RprobitB</a> asks the following formal
requirements:</p>
<ol style="list-style-type: decimal">
<li><p>The data set <strong>must</strong> be in “wide” format, that
means each row provides the full information for one choice occasion.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The&lt;code&gt;&lt;/code&gt;{tidyr}&lt;code&gt;package [contains functionality](https://tidyr.tidyverse.org/articles/pivot.html) that can transform a&lt;/code&gt;data.frame`
into this format.&lt;/p&gt;"><sup>2</sup></a></p></li>
<li><p>It <strong>must</strong> contain a column with unique identifiers
for each decision maker. Additionally, it <strong>can</strong> contain a
column with identifier for each choice situation of each decider. If
this information is missing, these identifier are generated
automatically by the appearance of the choices in the data set.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The choice situation identifier are irrelevant for model
estimation because &lt;a href="https://loelschlaeger.de/RprobitB/"&gt;RprobitB&lt;/a&gt; does not model correlation
over choice occasions. They are useful to identify specific choice
occasions later on.&lt;/p&gt;'><sup>3</sup></a></p></li>
<li><p>It <strong>can</strong> contain a column with the observed
choices. Such a column is required for model fitting but not for
prediction.</p></li>
<li><p>It <strong>must</strong> contain columns for the values of each
alternative specific covariate for each alternative and for each decider
specific covariate.</p></li>
</ol>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>The <code>train_choice</code> data set contains 2929 stated choices
by 235 Dutch individuals deciding between two virtual train trip options
based on the price, the travel time, the level of comfort, and the
number of changes. It fulfills the above requirements: Each row
represents one choice occasion, the columns <code>id</code> and
<code>choiceid</code> identify the deciders and the choice occasions,
respectively. The column <code>choice</code> gives the observed choices.
Four alternative-specific covariates are available, namely
<code>price</code>, <code>time</code>, <code>change</code>, and
<code>comfort</code>. There values are given for each alternative.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;For alternative specific variables, the alternative
names must be added to the covariates via the &lt;code&gt;_&lt;/code&gt;
separator.&lt;/p&gt;"><sup>4</sup></a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">train_choice</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    2929 obs. of  11 variables:</span></span>
<span><span class="co">#&gt;  $ deciderID : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ occasionID: int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ choice    : chr  "A" "A" "A" "B" ...</span></span>
<span><span class="co">#&gt;  $ price_A   : num  52.9 52.9 52.9 88.1 52.9 ...</span></span>
<span><span class="co">#&gt;  $ time_A    : num  2.5 2.5 1.92 2.17 2.5 ...</span></span>
<span><span class="co">#&gt;  $ change_A  : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ comfort_A : int  1 1 1 1 1 0 1 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ price_B   : num  88.1 70.5 88.1 70.5 70.5 ...</span></span>
<span><span class="co">#&gt;  $ time_B    : num  2.5 2.17 1.92 2.5 2.5 ...</span></span>
<span><span class="co">#&gt;  $ change_B  : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ comfort_B : int  1 1 0 0 0 0 1 0 1 0 ...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-model-formula">The model formula<a class="anchor" aria-label="anchor" href="#the-model-formula"></a>
</h2>
<p>We have to inform <a href="https://loelschlaeger.de/RprobitB/">RprobitB</a> about the covariates we
want to include in our model via specifying a <code>formula</code>
object. Say we want to model the utility <span class="math inline">\(U_{n,t,j}\)</span> of decider <span class="math inline">\(n\)</span> at choice occasion <span class="math inline">\(t\)</span> for alternative <span class="math inline">\(j\)</span> via the linear equation</p>
<p><span class="math display">\[U_{n,t,j} = A_{n,t,j} \beta_1 + B_{n,t}
\beta_{2,j} + C_{n,t,j} \beta_{3,j} + \epsilon_{n,tj}.\]</span> Here,
<span class="math inline">\(A\)</span> and <span class="math inline">\(C\)</span> are alternative and choice situation
specific covariates, whereas <span class="math inline">\(B\)</span> is
choice situation specific. The coefficient <span class="math inline">\(\beta_1\)</span> is generic (i.e. the same for
each alternative), whereas <span class="math inline">\(\beta_{2,j}\)</span> and <span class="math inline">\(\beta_{3,j}\)</span> are alternative specific.</p>
<p>To represent this structure, the <code>formula</code> object is of
the form (analogously to <a href="https://cran.r-project.org/package=mlogit" class="external-link">mlogit</a>)
<code>choice ~ A | B | C</code>, where</p>
<ul>
<li><p><code>choice</code> is the dependent variable (the discrete
choice we aim to explain),</p></li>
<li><p><code>A</code> are alternative and choice situation specific
covariates with a generic coefficient (we call them covariates of type
1),</p></li>
<li><p><code>B</code> are choice situation specific covariates with
alternative specific coefficients<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Mind that not all alternative specific coefficients of
type 2-covariates are identified. This is because the probit model is
estimated on utility differences since the level of the utility is
irrelevant, see the vignette on the model definition. Therefore, the
coefficient of the last alternative of each type 2-covariate is set to
0.&lt;/p&gt;"><sup>5</sup></a> (we call them covariates of type
2),</p></li>
<li><p>and <code>C</code> are alternative and choice situation specific
covariates with alternative specific coefficients (we call them
covariates of type 3).</p></li>
</ul>
<p>Specifying a <code>formula</code> object for <a href="https://loelschlaeger.de/RprobitB/">RprobitB</a>
must be consistent with the following rules:</p>
<ul>
<li><p>By default, alternative specific constants (ASCs)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;ASCs capture the average effect on utility of all
factors that are not included in the model. Due to identifiability, we
cannot estimate ASCs for all the alternatives. Therefore, they are added
for all except for the last alternative.&lt;/p&gt;"><sup>6</sup></a> are added to the
model. They can be removed by adding <code>+ 0</code> in the second
spot, e.g. <code>choice ~ A | B + 0 | C</code>.</p></li>
<li><p>To exclude covariates of the backmost categories, use either
<code>0</code>, e.g. <code>choice ~ A | B | 0</code> or just leave this
part out and write <code>choice ~ A | B</code>. However, to exclude
covariates of front categories, we have to use <code>0</code>,
e.g. <code>choice ~ 0 | B</code>.</p></li>
<li><p>To include more than one covariate of the same category, use
<code>+</code>, e.g. <code>choice ~ A1 + A2 | B</code>.</p></li>
<li><p>If we don’t want to include any covariates of the second category
but we want to estimate alternative specific constants, add
<code>1</code> in the second spot, e.g. <code>choice ~ A | 1</code>. The
expression <code>choice ~ A | 0</code> is interpreted as no covariates
of the second category and no alternative specific constants.</p></li>
</ul>
<p>To impose random effects for specific variables, we need to define a
character vector <code>re</code> with the corresponding variable names.
To have random effects for the alternative specific constants, include
<code>"ASC"</code> in <code>re</code>.</p>
<div class="section level3">
<h3 id="example-1">Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>We specify a model formula for the <code>train_choice</code> data
set. Say we want to include all the covariates <code>price</code>,
<code>time</code>, <code>comfort</code>, and <code>change</code>, which
are all alternative specific (that is, they contain a potentially
different value for each alternative, such as different prices for A and
B), so either of type 1 or type 3. The difference between type 1 and
type 3 is that in the former case, we would estimate a generic
coefficient (i.e. a coefficient that is constant across alternatives),
whereas in the latter case, we would estimate alternative specific
coefficients. Deciding between type 1 and type 3 for these covariates
belongs into the topic of model selection, for which we provide a
separate vignette. For now, we go with type 1 for all covariates and
remove ASCs:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="va">choice</span> <span class="op">~</span> <span class="va">price</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">comfort</span> <span class="op">+</span> <span class="va">change</span> <span class="op">|</span> <span class="fl">0</span></span></code></pre></div>
<p>Additionally, we specify random effects for <code>price</code> and
<code>time</code> (because we would typically expect heterogeneity
here):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-prepare_data-function">The <code>prepare_data()</code> function<a class="anchor" aria-label="anchor" href="#the-prepare_data-function"></a>
</h2>
<p>Before model estimation with <a href="https://loelschlaeger.de/RprobitB/">RprobitB</a>, any empirical
choice data set <code>choice_data</code> must pass the
<code><a href="../reference/prepare_data.html">prepare_data()</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>form <span class="op">=</span> <span class="va">form</span>, choice_data <span class="op">=</span> <span class="va">choice_data</span><span class="op">)</span></span></code></pre></div>
<p>The function performs compatibility checks and data transformations
and returns an object of class <code>RprobitB_data</code> that can be
fed into the estimation routine <code><a href="../reference/fit_model.html">fit_model()</a></code>. The following
arguments are optional:</p>
<ul>
<li><p><code>re</code>: The character vector of variable names of
<code>form</code> with random effects. <code>re = NULL</code> per
default, i.e. no random effects.</p></li>
<li><p><code>alternatives</code>: We may not want to consider all
alternatives in <code>choice_data</code>. In that case, we can specify a
character vector <code>alternatives</code> with selected names of
alternatives. If not specified, the choice set is defined by the
observed choices.</p></li>
<li><p><code>id</code>: A character (single string), the name of the
column in <code>choice_data</code> that contains a unique identifier for
each decision maker. The default is <code>"id"</code>.</p></li>
<li><p><code>idc</code>: A character, the name of the column in
<code>choice_data</code> that contains a unique identifier for each
choice situation given the decision maker. Per default, these identifier
are generated by the appearance of the choices in the data set.</p></li>
<li><p><code>standardize</code>: A character vector of variable names of
<code>form</code> that get standardized. Covariates of type 1 or 3 have
to be addressed by <code>&lt;covariate&gt;_&lt;alternative&gt;</code>.
If <code>standardize = "all"</code>, all covariates get standardized.
Per default, no covariate is standardized.</p></li>
<li>
<p><code>impute</code>: Specifies how to handle missing entries
(<code>NA, NaN, -Inf, Inf</code>) in <code>choice_data</code>. The
following options are available:</p>
<ul>
<li><p><code>"complete_cases"</code>, which removes rows containing
missing entries (the default),</p></li>
<li><p><code>"zero"</code>, which replaces missing entries by
zero,</p></li>
<li><p><code>"mean"</code>, which imputes missing entries by the
covariate mean.</p></li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="example-2">Example<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h3>
<p>Let’s prepare the <code>train_choice</code> data set for estimation
with our previous specification of <code>form</code> and
<code>re</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span>form <span class="op">=</span> <span class="va">form</span>, choice_data <span class="op">=</span> <span class="va">train_choice</span>, re <span class="op">=</span> <span class="va">re</span>, id <span class="op">=</span> <span class="st">"deciderID"</span>, idc <span class="op">=</span> <span class="st">"occasionID"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>summary</code> and <code>plot</code> methods provide a
quick data overview:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  count</span></span>
<span><span class="co">#&gt; deciders           235</span></span>
<span><span class="co">#&gt; choice occasions  5-19</span></span>
<span><span class="co">#&gt; total choices     2929</span></span>
<span><span class="co">#&gt; alternatives         2</span></span>
<span><span class="co">#&gt; - 'A'             1474</span></span>
<span><span class="co">#&gt; - 'B'             1455</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/summary-train-choice-data-1.png" width="75%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="ordered-alternatives">Ordered alternatives<a class="anchor" aria-label="anchor" href="#ordered-alternatives"></a>
</h2>
<p>The two choice alternatives from the train trip example are
unordered. If we had asked “rate your train trip from 1 (horrible) to 7
(great)”, then the respondents would choose from a set of ordered
alternatives. Such ordered alternatives can by analyzed by setting
<code>ordered = TRUE</code> in <code>prepare_data</code>. In this case,
<code>alternatives</code> becomes a mandatory argument, where the
alternatives must be named from worst to best.</p>
</div>
<div class="section level2">
<h2 id="ranked-choices">Ranked choices<a class="anchor" aria-label="anchor" href="#ranked-choices"></a>
</h2>
<p>Rather than recording only the single most preferred alternative,
some surveys ask for a full ranking of all the alternatives, which
reveals far more about the underlying preferences. Ranked choices can by
analyzed by setting <code>ranked = TRUE</code> in
<code><a href="../reference/prepare_data.html">prepare_data()</a></code>. The choice column of the data set must
provide the full ranking for each choice occasion (from most preferred
to least preferred), where the alternatives are separated by commas.</p>
<p>The ranked probit model follows directly from the basic multivariate
case. The only difference is that we take flexible utility differences
such that the differenced utility vector is always negative. Thereby, we
incorporate information of the full ranking.</p>
</div>
<div class="section level2">
<h2 id="simulate-choices">Simulate choices<a class="anchor" aria-label="anchor" href="#simulate-choices"></a>
</h2>
<p>The <code>simulate_choices</code> function simulates discrete choice
data from a prespecified probit model. Say we want to simulate the
choices of <code>N</code> deciders in <code>T</code> choice occasions<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;code&gt;T&lt;/code&gt; can be either a positive number,
representing a fixed number of choice occasions for each decision maker,
or a vector of length &lt;code&gt;N&lt;/code&gt; with decision maker specific
numbers of choice occasions.&lt;/p&gt;"><sup>7</sup></a> among
<code>J</code> alternatives from a model formulation <code>form</code>,
we have to call</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_choices.html">simulate_choices</a></span><span class="op">(</span>form <span class="op">=</span> <span class="va">form</span>, N <span class="op">=</span> <span class="va">N</span>, T <span class="op">=</span> <span class="cn">T</span>, J <span class="op">=</span> <span class="va">J</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/simulate_choices.html">simulate_choices()</a></code> has the following
optional arguments:</p>
<ul>
<li><p><code>re</code>: The character vector of variable names of
<code>form</code> with random effects.</p></li>
<li><p><code>alternatives</code>: A character vector of length
<code>J</code> with the names of the choice alternatives. If not
specified, the alternatives are labeled by the first <code>J</code>
upper-case letters of the Roman alphabet.</p></li>
<li><p><code>covariates</code>: A named list of covariate values. Each
element must be a vector of length equal to the number of choice
occasions and named according to a covariate, or follow the naming
convention for alternative specific covariates,
i.e. <code>&lt;covariate&gt;_&lt;alternative&gt;</code>. Covariates for
which no values are specified are drawn from a standard normal
distribution.</p></li>
<li><p><code>standardize</code>: A character vector of variable names of
<code>form</code> that get standardized.</p></li>
<li><p><code>seed</code>: Set a seed for the simulation.</p></li>
</ul>
<p>We can specify the true parameters<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;See the vignette on the model definition for more
details, especially for the meaning of the parameters.&lt;/p&gt;"><sup>8</sup></a> by adding a named list with values for</p>
<ul>
<li><p><code>alpha</code>, the fixed coefficient vector,</p></li>
<li><p><code>C</code>, the number (greater or equal 1) of latent classes
of decision makers,</p></li>
<li><p><code>s</code>, the vector of class weights,</p></li>
<li><p><code>b</code>, the matrix of class means as columns,</p></li>
<li><p><code>Omega</code>, the matrix of class covariance matrices as
columns,</p></li>
<li><p><code>Sigma</code>, the differenced error term covariance matrix,
or <code>Sigma_full</code>, the full error term covariance
matrix,</p></li>
<li><p><code>beta</code>, the matrix of the decision-maker specific
coefficient vectors,</p></li>
<li><p><code>z</code>, the class allocation vector,</p></li>
<li><p><code>d</code>, the vector of logarithmic threshold increments in
the ordered probit case.</p></li>
</ul>
<p>True parameters that are not specified will be set at random.</p>
<div class="section level3">
<h3 id="example-3">Example<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h3>
<p>For illustration, we simulate the choices of <code>N = 100</code>
deciders at <code>T = 10</code> choice occasions between the
alternatives <code>A</code> and <code>B</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">alternatives</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="va">base</span> <span class="op">&lt;-</span> <span class="st">"B"</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="va">choice</span> <span class="op">~</span> <span class="va">var1</span> <span class="op">|</span> <span class="va">var2</span> <span class="op">|</span> <span class="va">var3</span></span>
<span><span class="va">re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ASC"</span>, <span class="st">"var2"</span><span class="op">)</span></span></code></pre></div>
<p><a href="https://loelschlaeger.de/RprobitB/">RprobitB</a> provides the function
<code><a href="../reference/overview_effects.html">overview_effects()</a></code> which can be used to get an overview of
the effects for which parameters can be specified:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/overview_effects.html">overview_effects</a></span><span class="op">(</span>form <span class="op">=</span> <span class="va">form</span>, re <span class="op">=</span> <span class="va">re</span>, alternatives <span class="op">=</span> <span class="va">alternatives</span>, base <span class="op">=</span> <span class="va">base</span><span class="op">)</span></span>
<span><span class="co">#&gt;   effect as_value as_coef random</span></span>
<span><span class="co">#&gt; 1   var1     TRUE   FALSE  FALSE</span></span>
<span><span class="co">#&gt; 2 var3_A     TRUE    TRUE  FALSE</span></span>
<span><span class="co">#&gt; 3 var3_B     TRUE    TRUE  FALSE</span></span>
<span><span class="co">#&gt; 4 var2_A    FALSE    TRUE   TRUE</span></span>
<span><span class="co">#&gt; 5  ASC_A    FALSE    TRUE   TRUE</span></span></code></pre></div>
<p>Hence, the coefficient vector <code>alpha</code> must be of length 3,
where the elements 1 to 3 correspond to <code>var1</code>,
<code>var3_A</code>, and <code>var3_B</code>, respectively. The matrix
<code>b</code> must be of dimension 2 x <code>C</code>, where (by
default) <code>C = 1</code> and row 1 and 2 correspond to
<code>var2_A</code> and <code>ASC_A</code>, respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_choices.html">simulate_choices</a></span><span class="op">(</span></span>
<span>  form <span class="op">=</span> <span class="va">form</span>,</span>
<span>  N <span class="op">=</span> <span class="va">N</span>,</span>
<span>  T <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  J <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  re <span class="op">=</span> <span class="va">re</span>,</span>
<span>  alternatives <span class="op">=</span> <span class="va">alternatives</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  true_parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  count</span></span>
<span><span class="co">#&gt; deciders           100</span></span>
<span><span class="co">#&gt; choice occasions    10</span></span>
<span><span class="co">#&gt; total choices     1000</span></span>
<span><span class="co">#&gt; alternatives         2</span></span>
<span><span class="co">#&gt; - 'A'              435</span></span>
<span><span class="co">#&gt; - 'B'              565</span></span></code></pre></div>
<p>We can visualize the covariates grouped by the chosen
alternatives:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span>, by_choice <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/data-plot-by-choice-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>What we see is consistent with our specification: Higher values of
<code>var1_A</code> for example correspond more frequently to choice
<code>B</code> (upper-right panel), because the coefficient of
<code>var1</code> (the first value of <code>alpha</code>) is
negative.</p>
</div>
</div>
<div class="section level2">
<h2 id="train-and-test-data-set">Train and test data set<a class="anchor" aria-label="anchor" href="#train-and-test-data-set"></a>
</h2>
<p>The function <code><a href="../reference/train_test.html">train_test()</a></code> can be used to split the
output of <code><a href="../reference/prepare_data.html">prepare_data()</a></code> or <code><a href="../reference/simulate_choices.html">simulate_choices()</a></code>
into a train and a test subset. This is useful when evaluating the
prediction performance of a fitted model. For example, the following
code puts 70% of deciders from our simulated <code>data</code> into the
train subsample and 30% of deciders in the test subsample:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/train_test.html">train_test</a></span><span class="op">(</span><span class="va">data</span>, test_proportion <span class="op">=</span> <span class="fl">0.3</span>, by <span class="op">=</span> <span class="st">"N"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $train</span></span>
<span><span class="co">#&gt; Simulated data of 700 choices.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $test</span></span>
<span><span class="co">#&gt; Simulated data of 300 choices.</span></span></code></pre></div>
<p>Alternatively, the following code puts 2 randomly chosen choice
occasions per decider from <code>data</code> into the test subsample,
the rest goes into the train subsample:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/train_test.html">train_test</a></span><span class="op">(</span><span class="va">data</span>, test_number <span class="op">=</span> <span class="fl">2</span>, by <span class="op">=</span> <span class="st">"T"</span>, random <span class="op">=</span> <span class="cn">TRUE</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $train</span></span>
<span><span class="co">#&gt; Simulated data of 800 choices.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $test</span></span>
<span><span class="co">#&gt; Simulated data of 200 choices.</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Train2009" class="csl-entry">
Train, K. 2009. <em>Discrete Choice Methods with Simulation</em>.
Cambridge University Press. <a href="https://doi.org/10.1017/CBO9780511805271" class="external-link">https://doi.org/10.1017/CBO9780511805271</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a>, <a href="https://de.wikipedia.org/wiki/Dietmar_Bauer" class="external-link">Dietmar Bauer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
