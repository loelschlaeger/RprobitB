<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function prepares choice data for estimation."><title>Prepare choice data for estimation — prepare_data • RprobitB</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare choice data for estimation — prepare_data"><meta property="og:description" content="This function prepares choice data for estimation."><meta property="og:image" content="https://loelschlaeger.de/RprobitB/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RprobitB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/RprobitB.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v01_model_definition.html">Model definition</a>
    <a class="dropdown-item" href="../articles/v02_choice_data.html">Choice data</a>
    <a class="dropdown-item" href="../articles/v03_model_fitting.html">Model fitting</a>
    <a class="dropdown-item" href="../articles/v04_modeling_heterogeneity.html">Modeling heterogeneity</a>
    <a class="dropdown-item" href="../articles/v05_choice_prediction.html">Choice prediction</a>
    <a class="dropdown-item" href="../articles/v06_model_selection.html">Model selection</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/loelschlaeger/RprobitB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Prepare choice data for estimation</h1>
      <small class="dont-index">Source: <a href="https://github.com/loelschlaeger/RprobitB/blob/HEAD/R/data_management.R" class="external-link"><code>R/data_management.R</code></a></small>
      <div class="d-none name"><code>prepare_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function prepares choice data for estimation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prepare_data</span><span class="op">(</span></span>
<span>  <span class="va">form</span>,</span>
<span>  <span class="va">choice_data</span>,</span>
<span>  re <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alternatives <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ordered <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ranked <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  base <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  idc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  impute <span class="op">=</span> <span class="st">"complete_cases"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>form</dt>
<dd><p>A <code>formula</code> object that is used to specify the model equation.
The structure is <code>choice ~ A | B | C</code>, where</p><ul><li><p><code>choice</code> is the name of the dependent variable (the choices),</p></li>
<li><p><code>A</code> are names of alternative and choice situation specific
covariates with a coefficient that is constant across alternatives,</p></li>
<li><p><code>B</code> are names of choice situation specific covariates with
alternative specific coefficients,</p></li>
<li><p>and <code>C</code> are names of alternative and choice situation specific
covariates with alternative specific coefficients.</p></li>
</ul><p>Multiple covariates (of one type) are separated by a <code>+</code> sign.
By default, alternative specific constants (ASCs) are added to the model.
They can be removed by adding <code>+0</code> in the second spot.</p>
<p>In the ordered probit model (<code>ordered = TRUE</code>), the <code>formula</code>
object has the simple structure <code>choice ~ A</code>. ASCs are not estimated.</p></dd>


<dt>choice_data</dt>
<dd><p>A <code>data.frame</code> of choice data in wide format, i.e. each row represents
one choice occasion.</p></dd>


<dt>re</dt>
<dd><p>A character (vector) of covariates of <code>form</code> with random effects.
If <code>re = NULL</code> (the default), there are no random effects.
To have random effects for the ASCs, include <code>"ASC"</code> in <code>re</code>.</p></dd>


<dt>alternatives</dt>
<dd><p>A character vector with the names of the choice alternatives.
If not specified, the choice set is defined by the observed choices.
If <code>ordered = TRUE</code>, <code>alternatives</code> is assumed to be specified with
the alternatives ordered from worst to best.</p></dd>


<dt>ordered</dt>
<dd><p>A boolean, <code>FALSE</code> per default. If <code>TRUE</code>, the choice set
<code>alternatives</code> is assumed to be ordered from worst to best.</p></dd>


<dt>ranked</dt>
<dd><p>TBA</p></dd>


<dt>base</dt>
<dd><p>A character, the name of the base alternative for covariates that are not
alternative specific (i.e. type 2 covariates and ASCs). Ignored and set to
<code>NULL</code> if the model has no alternative specific covariates (e.g. in the
ordered probit model).
Per default, <code>base</code> is the last element of <code>alternatives</code>.</p></dd>


<dt>id</dt>
<dd><p>A character, the name of the column in <code>choice_data</code> that contains
unique identifier for each decision maker. The default is <code>"id"</code>.</p></dd>


<dt>idc</dt>
<dd><p>A character, the name of the column in <code>choice_data</code> that contains
unique identifier for each choice situation of each decision maker.
Per default, these identifier are generated by the order of appearance.</p></dd>


<dt>standardize</dt>
<dd><p>A character vector of names of covariates that get standardized.
Covariates of type 1 or 3 have to be addressed by
<code>&lt;covariate&gt;_&lt;alternative&gt;</code>.
If <code>standardize = "all"</code>, all covariates get standardized.</p></dd>


<dt>impute</dt>
<dd><p>A character that specifies how to handle missing covariate entries in
<code>choice_data</code>, one of:</p><ul><li><p><code>"complete_cases"</code>, removes all rows containing missing
covariate entries (the default),</p></li>
<li><p><code>"zero"</code>, replaces missing covariate entries by zero
(only for numeric columns),</p></li>
<li><p><code>"mean"</code>, imputes missing covariate entries by the mean
(only for numeric columns).</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>RprobitB_data</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Requirements for the <code>data.frame</code> <code>choice_data</code>:</p><ul><li><p>It <strong>must</strong> contain a column named <code>id</code> which contains unique
identifier for each decision maker.</p></li>
<li><p>It <strong>can</strong> contain a column named <code>idc</code> which contains unique
identifier for each choice situation of each decision maker.
If this information is missing, these identifier are generated
automatically by the appearance of the choices in the data set.</p></li>
<li><p>It <strong>can</strong> contain a column named <code>choice</code> with the observed
choices, where <code>choice</code> must match the name of the dependent
variable in <code>form</code>.
Such a column is required for model fitting but not for prediction.</p></li>
<li><p>It <strong>must</strong> contain a numeric column named <em>p_j</em> for each alternative
specific covariate <em>p</em> in <code>form</code> and each choice alternative <em>j</em>
in <code>alternatives</code>.</p></li>
<li><p>It <strong>must</strong> contain a numeric column named <em>q</em> for each covariate <em>q</em>
in <code>form</code> that is constant across alternatives.</p></li>
</ul><p>In the ordered case (<code>ordered = TRUE</code>), the column <code>choice</code> must
contain the full ranking of the alternatives in each choice occasion as a
character, where the alternatives are separated by commas, see the examples.</p>
<p>See <a href="https://loelschlaeger.de/RprobitB/articles/v02_choice_data.html">the vignette on choice data</a>
for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="check_form.html">check_form()</a></code> for checking the model formula</p></li>
<li><p><code><a href="overview_effects.html">overview_effects()</a></code> for an overview of the model effects</p></li>
<li><p><code><a href="create_lagged_cov.html">create_lagged_cov()</a></code> for creating lagged covariates</p></li>
<li><p><code><a href="as_cov_names.html">as_cov_names()</a></code> for re-labeling alternative-specific covariates</p></li>
<li><p><code><a href="simulate_choices.html">simulate_choices()</a></code> for simulating choice data</p></li>
<li><p><code><a href="train_test.html">train_test()</a></code> for splitting choice data into a train and test subset</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Train"</span>, package <span class="op">=</span> <span class="st">"mlogit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prepare_data</span><span class="op">(</span></span></span>
<span class="r-in"><span>  form <span class="op">=</span> <span class="va">choice</span> <span class="op">~</span> <span class="va">price</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">comfort</span> <span class="op">+</span> <span class="va">change</span> <span class="op">|</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  choice_data <span class="op">=</span> <span class="va">Train</span>,</span></span>
<span class="r-in"><span>  re <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"time"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="st">"id"</span>,</span></span>
<span class="r-in"><span>  idc <span class="op">=</span> <span class="st">"choiceid"</span>,</span></span>
<span class="r-in"><span>  standardize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"time"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking for missing covariates</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### ranked case</span></span></span>
<span class="r-in"><span><span class="va">choice_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"id"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">"choice"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A,B,C"</span>,<span class="st">"A,C,B"</span>,<span class="st">"B,C,A"</span><span class="op">)</span>, <span class="st">"cov"</span> <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prepare_data</span><span class="op">(</span></span></span>
<span class="r-in"><span>  form <span class="op">=</span> <span class="va">choice</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">cov</span> <span class="op">+</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  choice_data <span class="op">=</span> <span class="va">choice_data</span>,</span></span>
<span class="r-in"><span>  ranked <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking for missing covariates</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a>, <a href="https://de.wikipedia.org/wiki/Dietmar_Bauer" class="external-link">Dietmar Bauer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

